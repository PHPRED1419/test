/*!selectize.js - v0.6.9 | https://github.com/brianreavis/selectize.js | Apache License (v2)*/ !function(t){"object"==typeof exports?t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){var e=function(t,e){if("string"!=typeof e||e.length){var i="string"==typeof e?RegExp(e,"i"):e,s=function(t){var e=0;if(3===t.nodeType){var n=t.data.search(i);if(0<=n&&0<t.data.length){var o=t.data.match(i),e=document.createElement("span");e.className="highlight",(t=t.splitText(n)).splitText(o[0].length),n=t.cloneNode(!0),e.appendChild(n),t.parentNode.replaceChild(e,t),e=1}}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName))for(n=0;n<t.childNodes.length;++n)n+=s(t.childNodes[n]);return e};return t.each(function(){s(this)})}},i=function(){};i.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){this._events=this._events||{},!1!=t in this._events&&this._events[t].splice(this._events[t].indexOf(e),1)},trigger:function(t){if(this._events=this._events||{},!1!=t in this._events)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},i.mixin=function(t){for(var e=["on","off","trigger"],s=0;s<e.length;s++)t.prototype[e[s]]=i.prototype[e[s]]};var s,n=/Mac/.test(navigator.userAgent),o=n?91:17,r=n?18:17,a={a:"[a\xc0\xc1\xc2\xc3\xc4\xc5\xe0\xe1\xe2\xe3\xe4\xe5]",c:"[c\xc7\xe7]",e:"[e\xc8\xc9\xca\xcb\xe8\xe9\xea\xeb]",i:"[i\xcc\xcd\xce\xcf\xec\xed\xee\xef]",n:"[n\xd1\xf1]",o:"[o\xd2\xd3\xd4\xd5\xd5\xd6\xd8\xf2\xf3\xf4\xf5\xf6\xf8]",s:"[sŠš]",u:"[u\xd9\xda\xdb\xdc\xf9\xfa\xfb\xfc]",y:"[yŸ\xff\xfd]",z:"[zŽž]"},l=function(t){return void 0!==t},h=function(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},u={before:function(t,e,i){var s=t[e];t[e]=function(){return i.apply(t,arguments),s.apply(t,arguments)}},after:function(t,e,i){var s=t[e];t[e]=function(){var e=s.apply(t,arguments);return i.apply(t,arguments),e}}},p=function(e,i){if(!t.isArray(i))return i;var s,n,o={};for(s=0,n=i.length;s<n;s++)i[s].hasOwnProperty(e)&&(o[i[s][e]]=i[s]);return o},c=function(t){var e=!1;return function(){e||(e=!0,t.apply(this,arguments))}},d=function(t,e){var i;return function(){var s=this,n=arguments;window.clearTimeout(i),i=window.setTimeout(function(){t.apply(s,n)},e)}},g=function(t,e,i){var s,n=t.trigger,o={};for(s in t.trigger=function(){var i=arguments[0];if(-1===e.indexOf(i))return n.apply(t,arguments);o[i]=arguments},i.apply(t,[]),t.trigger=n,o)o.hasOwnProperty(s)&&n.apply(t,o[s])},f=function(t,e,i,s){t.on(e,i,function(e){for(var i=e.target;i&&i.parentNode!==t[0];)i=i.parentNode;return e.currentTarget=i,s.apply(this,[e])})},v=function(t){var e={};if("selectionStart"in t)e.start=t.selectionStart,e.length=t.selectionEnd-e.start;else if(document.selection){t.focus();var i=document.selection.createRange(),s=document.selection.createRange().text.length;i.moveStart("character",-t.value.length),e.start=i.text.length-s,e.length=s}return e},$=function(e){var i=function(i){var s,n,o;if(!(i=i||window.event||{}).metaKey&&!i.altKey&&!1!==e.data("grow")){s=e.val(),i.type&&"keydown"===i.type.toLowerCase()&&(o=97<=(n=i.keyCode)&&122>=n||65<=n&&90>=n||48<=n&&57>=n||32==n,46===n||8===n?(i=v(e[0])).length?s=s.substring(0,i.start)+s.substring(i.start+i.length):8===n&&i.start?s=s.substring(0,i.start-1)+s.substring(i.start+1):46===n&&void 0!==i.start&&(s=s.substring(0,i.start)+s.substring(i.start+1)):o&&(n=i.shiftKey,i=String.fromCharCode(i.keyCode),s+=i=n?i.toUpperCase():i.toLowerCase())),i=e.attr("placeholder")||"",!s.length&&i.length&&(s=i),s=t("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"nowrap"}).text(s).appendTo("body");var r={};for(n=0,i=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"],o=i.length;n<o;n++)r[i[n]]=e.css(i[n]);s.css(r),i=s.width(),s.remove(),(s=i+4)!==e.width()&&(e.width(s),e.triggerHandler("resize"))}};e.on("keydown keyup update blur",i),i()},m=function(e,i){e[0].selectize=this,t.extend(this,{settings:i,$input:e,tagType:"select"===e[0].tagName.toLowerCase()?1:2,highlightedValue:null,isOpen:!1,isDisabled:!1,isLocked:!1,isFocused:!1,isInputFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:d(this.onSearchChange,i.loadThrottle)}),t.extend(this.options,p(i.valueField,i.options)),delete this.settings.options,t.extend(this.optgroups,p(i.optgroupValueField,i.optgroups)),delete this.settings.optgroups,this.settings.mode=this.settings.mode||(1===this.settings.maxItems?"single":"multi"),"boolean"!=typeof this.settings.hideSelected&&(this.settings.hideSelected="multi"===this.settings.mode),this.loadPlugins(this.settings.plugins),this.setupCallbacks(),this.setup()};return i.mixin(m),(s=m).plugins={},s.prototype.loadPlugins=function(e){var i,s;if(this.plugins=[],this.pluginSettings={},t.isArray(e))for(i=0,s=e.length;i<s;i++)this.loadPlugin(e[i]);else if(e)for(i in this.pluginSettings=t.extend({},e),e)e.hasOwnProperty(i)&&this.loadPlugin(i)},s.prototype.loadPlugin=function(t){var e,i,n;if(-1===this.plugins.indexOf(t)){if(!s.plugins.hasOwnProperty(t))throw Error('Selectize unable to find "'+t+'" plugin');for(e=s.plugins[t],this.plugins.push(t),i=0,n=e.dependencies.length;i<n;i++)this.loadPlugin(e.dependencies[i]);e.fn.apply(this,[this.pluginSettings[t]||{}])}},s.registerPlugin=function(t){var e=arguments;s.plugins[t]={name:t,fn:e[e.length-1],dependencies:3===e.length?e[1]:[]}},t.extend(m.prototype,{setup:function(){var e,i,s,a,l,h,u=this,p=u.settings;e=u.$input.attr("class")||"",e=t("<div>").addClass(p.theme).addClass(p.wrapperClass).addClass(e),i=t("<div>").addClass(p.inputClass).addClass("items").toggleClass("has-options",!t.isEmptyObject(u.options)).appendTo(e),s=t('<input type="text">').appendTo(i).attr("tabindex",s),a=t(p.dropdownParent||e),a=t("<div>").addClass(p.dropdownClass).hide().appendTo(a),l=t("<div>").addClass(p.dropdownContentClass).appendTo(a),e.css({width:u.$input[0].style.width,display:u.$input.css("display")}),u.plugins.length&&e.addClass("plugin-"+u.plugins.join(" plugin-")),h=u.settings.mode,e.toggleClass("single","single"===h),e.toggleClass("multi","multi"===h),(null===p.maxItems||1<p.maxItems)&&1===u.tagType&&u.$input.attr("multiple","multiple"),u.settings.placeholder&&s.attr("placeholder",p.placeholder),u.$wrapper=e,u.$control=i,u.$control_input=s,u.$dropdown=a,u.$dropdown_content=l,i.on("mousedown",function(t){t.isDefaultPrevented()||window.setTimeout(function(){u.focus(!0)},0)}),i.on("click",function(t){u.isInputFocused||u.focus(!0)}),a.on("mouseenter","[data-selectable]",function(){return u.onOptionHover.apply(u,arguments)}),a.on("mousedown","[data-selectable]",function(){return u.onOptionSelect.apply(u,arguments)}),f(i,"mousedown","*:not(input)",function(){return u.onItemSelect.apply(u,arguments)}),$(s),s.on({mousedown:function(t){t.stopPropagation()},keydown:function(){return u.onKeyDown.apply(u,arguments)},keyup:function(){return u.onKeyUp.apply(u,arguments)},keypress:function(){return u.onKeyPress.apply(u,arguments)},resize:function(){u.positionDropdown.apply(u,[])},blur:function(){return u.onBlur.apply(u,arguments)},focus:function(){return u.onFocus.apply(u,arguments)}}),t(document).on({keydown:function(t){u.isCmdDown=t[n?"metaKey":"ctrlKey"],u.isCtrlDown=t[n?"altKey":"ctrlKey"],u.isShiftDown=t.shiftKey},keyup:function(t){t.keyCode===r&&(u.isCtrlDown=!1),16===t.keyCode&&(u.isShiftDown=!1),t.keyCode===o&&(u.isCmdDown=!1)},mousedown:function(t){if(u.isFocused){if(t.target===u.$dropdown[0]){var e=u.ignoreFocus;u.ignoreFocus=!0,window.setTimeout(function(){u.ignoreFocus=e,u.focus(!1)},0)}else u.$control.has(t.target).length||t.target===u.$control[0]||u.blur()}}}),t(window).on({resize:function(){u.isOpen&&u.positionDropdown.apply(u,arguments)},mousemove:function(){u.ignoreHover=!1}}),u.$input.attr("tabindex",-1).hide().after(u.$wrapper),t.isArray(p.items)&&(u.setValue(p.items),delete p.items),u.updateOriginalInput(),u.refreshItems(),u.updatePlaceholder(),u.isSetup=!0,u.$input.is(":disabled")&&u.disable(),u.trigger("initialize"),p.preload&&u.onSearchChange("")},setupCallbacks:function(){var t,e,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType"};for(t in i)i.hasOwnProperty(t)&&(e=this.settings[i[t]])&&this.on(t,e)},triggerCallback:function(t){var e;"function"==typeof this.settings[t]&&(e=Array.prototype.slice.apply(arguments,[1]),this.settings[t].apply(this,e))},onKeyPress:function(t){if(this.isLocked)return t&&t.preventDefault();var e=String.fromCharCode(t.keyCode||t.which);if(this.settings.create&&e===this.settings.delimiter)return this.createItem(),t.preventDefault(),!1},onKeyDown:function(e){if(this.isLocked)9!==e.keyCode&&e.preventDefault();else{switch(e.keyCode){case 65:if(this.isCmdDown){this.selectAll(),e.preventDefault();return}break;case 27:this.blur();return;case 40:if(!this.isOpen&&this.hasOptions)this.open();else if(this.$activeOption){this.ignoreHover=!0;var i=this.getAdjacentOption(this.$activeOption,1);i.length&&this.setActiveOption(i,!0,!0)}e.preventDefault();return;case 38:this.$activeOption&&(this.ignoreHover=!0,(i=this.getAdjacentOption(this.$activeOption,-1)).length&&this.setActiveOption(i,!0,!0)),e.preventDefault();return;case 13:this.$activeOption&&this.onOptionSelect({currentTarget:this.$activeOption}),e.preventDefault();return;case 37:this.advanceSelection(-1,e);return;case 39:this.advanceSelection(1,e);return;case 9:this.settings.create&&t.trim(this.$control_input.val()).length&&(this.createItem(),e.preventDefault());return;case 8:case 46:this.deleteSelection(e);return}(this.isFull()||this.isInputHidden)&&e.preventDefault()}},onKeyUp:function(t){if(this.isLocked)return t&&t.preventDefault();t=this.$control_input.val()||"",this.lastValue!==t&&(this.lastValue=t,this.onSearchChange(t),this.refreshOptions(),this.trigger("type",t))},onSearchChange:function(t){var e=this,i=e.settings.load;i&&!e.loadedSearches.hasOwnProperty(t)&&(e.loadedSearches[t]=!0,e.load(function(s){i.apply(e,[t,s])}))},onFocus:function(t){if(this.isFocused=this.isInputFocused=!0,this.isDisabled)return this.blur(),t.preventDefault(),!1;this.ignoreFocus||("focus"===this.settings.preload&&this.onSearchChange(""),this.showInput(),this.setActiveItem(null),this.refreshOptions(!!this.settings.openOnFocus),this.refreshClasses())},onBlur:function(t){this.isInputFocused=!1,this.ignoreFocus||(this.close(),this.setActiveItem(null),this.setActiveOption(null),this.setCaret(this.items.length),this.isFocused=!1,this.refreshClasses())},onOptionHover:function(t){this.ignoreHover||this.setActiveOption(t.currentTarget,!1)},onOptionSelect:function(e){var i;e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),this.focus(!1),(i=t(e.currentTarget)).hasClass("create")?this.createItem():(i=i.attr("data-value"))&&(this.setTextboxValue(""),this.addItem(i),!this.settings.hideSelected&&e.type&&/mouse/.test(e.type)&&this.setActiveOption(this.getOption(i)))},onItemSelect:function(t){"multi"===this.settings.mode&&(t.preventDefault(),this.setActiveItem(t.currentTarget,t),this.focus(!1),this.hideInput())},load:function(t){var e=this,i=e.$wrapper.addClass("loading");e.loading++,t.apply(e,[function(t){e.loading=Math.max(e.loading-1,0),t&&t.length&&(e.addOption(t),e.refreshOptions(!1),e.isInputFocused&&e.open()),e.loading||i.removeClass("loading"),e.trigger("load",t)}])},setTextboxValue:function(t){this.$control_input.val(t).triggerHandler("update"),this.lastValue=t},getValue:function(){return 1===this.tagType&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(e){g(this,["change"],function(){this.clear();for(var i=t.isArray(e)?e:[e],s=0,n=i.length;s<n;s++)this.addItem(i[s])})},setActiveItem:function(e,i){var s,n,o;if((e=t(e)).length){if("mousedown"===(s=i&&i.type.toLowerCase())&&this.isShiftDown&&this.$activeItems.length){for(s=this.$control.children(".active:last"),(n=Array.prototype.indexOf.apply(this.$control[0].childNodes,[s[0]]))>(s=Array.prototype.indexOf.apply(this.$control[0].childNodes,[e[0]]))&&(o=n,n=s,s=o);n<=s;n++)o=this.$control[0].childNodes[n],-1===this.$activeItems.indexOf(o)&&(t(o).addClass("active"),this.$activeItems.push(o));i.preventDefault()}else"mousedown"===s&&this.isCtrlDown||"keydown"===s&&this.isShiftDown?e.hasClass("active")?(s=this.$activeItems.indexOf(e[0]),this.$activeItems.splice(s,1),e.removeClass("active")):this.$activeItems.push(e.addClass("active")[0]):(t(this.$activeItems).removeClass("active"),this.$activeItems=[e.addClass("active")[0]]);this.isFocused=!!this.$activeItems.length||this.isInputFocused}else t(this.$activeItems).removeClass("active"),this.$activeItems=[],this.isFocused=this.isInputFocused},setActiveOption:function(e,i,s){var n,o,r;this.$activeOption&&this.$activeOption.removeClass("active"),this.$activeOption=null,(e=t(e)).length&&(this.$activeOption=e.addClass("active"),i||!l(i))&&(e=this.$dropdown_content.height(),n=this.$activeOption.outerHeight(!0),i=this.$dropdown_content.scrollTop()||0,r=(o=this.$activeOption.offset().top-this.$dropdown_content.offset().top+i)-e+n,o+n>e-i?this.$dropdown_content.stop().animate({scrollTop:r},s?this.settings.scrollDuration:0):o<i&&this.$dropdown_content.stop().animate({scrollTop:o},s?this.settings.scrollDuration:0))},selectAll:function(){this.$activeItems=Array.prototype.slice.apply(this.$control.children(":not(input)").addClass("active")),this.isFocused=!0,this.$activeItems.length&&this.hideInput()},hideInput:function(){this.close(),this.setTextboxValue(""),this.$control_input.css({opacity:0,position:"absolute",left:-1e4}),this.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(t){var e=this;e.isDisabled||(e.ignoreFocus=!0,e.$control_input[0].focus(),e.isInputFocused=!0,window.setTimeout(function(){e.ignoreFocus=!1,t&&e.onFocus()},0))},blur:function(){this.$control_input.trigger("blur")},parseSearchTokens:function(e){if(!(e=t.trim(String(e||"").toLowerCase()))||!e.length)return[];var i,s,n,o=[],r=e.split(/ +/);for(e=0,i=r.length;e<i;e++){if(s=(r[e]+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),this.settings.diacritics)for(n in a)a.hasOwnProperty(n)&&(s=s.replace(RegExp(n,"g"),a[n]));o.push({string:r[e],regex:RegExp(s,"i")})}return o},getScoreFunction:function(t){var e=this,i=t.tokens,s=i.length?1===i.length?function(t){var e;return -1===(e=(t=String(t||"").toLowerCase()).search(i[0].regex))?0:(t=i[0].string.length/t.length,0===e&&(t+=.5),t)}:function(t){var e,s,n,o;for(t=String(t||"").toLowerCase(),n=e=0,o=i.length;n<o;n++){if(-1===(s=t.search(i[n].regex)))return 0;0===s&&(e+=.5),e+=i[n].string.length/t.length}return e/i.length}:function(){return 0};return function(){var t=e.settings.searchField;if("string"==typeof t&&(t=[t]),t&&t.length){if(1===t.length){var i=t[0];return function(t){return t.hasOwnProperty(i)?s(t[i]):0}}return function(e){for(var i=0,n=0,o=0,r=t.length;o<r;o++)e.hasOwnProperty(t[o])&&(n+=s(e[t[o]]),i++);return n/i}}return function(){return 0}}()},search:function(e,i){var s,n,o,r,a,l,h=this;if(i=i||{},(e=t.trim(String(e||"").toLowerCase()))!==h.lastQuery){if(h.lastQuery=e,a={query:e,tokens:h.parseSearchTokens(e),total:0,items:[]},h.settings.score){if("function"!=typeof(l=h.settings.score.apply(this,[a])))throw Error('Selectize "score" setting must be a function that returns a function')}else l=h.getScoreFunction(a);if(e.length){for(o in h.options)h.options.hasOwnProperty(o)&&0<(r=l(h.options[o]))&&a.items.push({score:r,value:o});a.items.sort(function(t,e){return e.score-t.score})}else{for(o in h.options)h.options.hasOwnProperty(o)&&a.items.push({score:1,value:o});h.settings.sortField&&a.items.sort((s=h.settings.sortField,n="desc"===h.settings.sortDirection?-1:1,function(t,e){return(t=t&&String(h.options[t.value][s]||"").toLowerCase())>(e=e&&String(h.options[e.value][s]||"").toLowerCase())?1*n:e>t?-1*n:0}))}h.currentResults=a}else a=t.extend(!0,{},h.currentResults);return h.prepareResults(a,i)},prepareResults:function(t,e){if(this.settings.hideSelected)for(var i=t.items.length-1;0<=i;i--)-1!==this.items.indexOf(String(t.items[i].value))&&t.items.splice(i,1);return t.total=t.items.length,"number"==typeof e.limit&&(t.items=t.items.slice(0,e.limit)),t},refreshOptions:function(i){void 0===i&&(i=!0);var s,n,o,r,a,l,h,u,p=this.$control_input.val(),c=this.search(p,{}),d=this.$dropdown_content;if(n=c.items.length,"number"==typeof this.settings.maxOptions&&(n=Math.min(n,this.settings.maxOptions)),o={},this.settings.optgroupOrder)for(r=this.settings.optgroupOrder,s=0;s<r.length;s++)o[r[s]]=[];else r=[];for(s=0;s<n;s++)l=(a=this.options[c.items[s].value])[this.settings.optgroupField]||"",this.optgroups.hasOwnProperty(l)||(l=""),o.hasOwnProperty(l)||(o[l]=[],r.push(l)),o[l].push(this.render("option",a));for(a=[],s=0,n=r.length;s<n;s++)l=r[s],this.optgroups.hasOwnProperty(l)&&o[l].length?(h=this.render("optgroup_header",this.optgroups[l])||"",h+=o[l].join(""),a.push(this.render("optgroup",t.extend({},this.optgroups[l],{html:h})))):a.push(o[l].join(""));if(d.html(a.join("")),this.settings.highlight&&c.query.length&&c.tokens.length)for(s=0,n=c.tokens.length;s<n;s++)e(d,c.tokens[s].regex);if(!this.settings.hideSelected)for(s=0,n=this.items.length;s<n;s++)this.getOption(this.items[s]).addClass("selected");(s=this.settings.create&&c.query.length)&&(d.prepend(this.render("option_create",{input:p})),u=t(d[0].childNodes[0])),(this.hasOptions=0<c.items.length||s)?(p=0<c.items.length?u?this.getAdjacentOption(u,1):d.find("[data-selectable]").first():u,this.setActiveOption(p),i&&!this.isOpen&&this.open()):(this.setActiveOption(null),i&&this.isOpen&&this.close())},addOption:function(e,i){var s,n;if(t.isArray(e))for(s=0,n=e.length;s<n;s++)this.addOption(e[s][this.settings.valueField],e[s]);else e=e||"",this.options.hasOwnProperty(e)||(this.userOptions[e]=!0,this.options[e]=i,this.lastQuery=null,this.trigger("option_add",e,i))},addOptionGroup:function(t,e){this.optgroups[t]=e,this.trigger("optgroup_add",value,e)},updateOption:function(e,i){var s,n;e=String(e),this.options[e]=i,l(this.renderCache.item)&&delete this.renderCache.item[e],l(this.renderCache.option)&&delete this.renderCache.option[e],-1!==this.items.indexOf(e)&&(s=this.getItem(e),n=t(this.render("item",i)),s.hasClass("active")&&n.addClass("active"),s.replaceWith(n)),this.isOpen&&this.refreshOptions(!1)},removeOption:function(t){t=String(t),delete this.userOptions[t],delete this.options[t],this.lastQuery=null,this.trigger("option_remove",t),this.removeItem(t)},clearOptions:function(){this.loadedSearches={},this.userOptions={},this.options={},this.lastQuery=null,this.trigger("option_clear"),this.clear()},getOption:function(e){return e?this.$dropdown_content.find("[data-selectable]").filter('[data-value="'+e.replace(/(['"])/g,"\\$1")+'"]:first'):t()},getAdjacentOption:function(e,i){var s=this.$dropdown.find("[data-selectable]"),n=s.index(e)+i;return 0<=n&&n<s.length?s.eq(n):t()},getItem:function(e){var i=this.items.indexOf(e);return -1!==i&&(i>=this.caretPos&&i++,(i=t(this.$control[0].childNodes[i])).attr("data-value")===e)?i:t()},addItem:function(e){g(this,["change"],function(){var i,s,n,o=this,r=o.settings.mode;e=String(e),"single"===r&&o.clear(),"multi"===r&&o.isFull()||-1!==o.items.indexOf(e)||!o.options.hasOwnProperty(e)||(i=t(o.render("item",o.options[e])),o.items.splice(o.caretPos,0,e),o.insertAtCaret(i),o.refreshClasses(),o.isSetup&&(n=o.$dropdown_content.find("[data-selectable]"),s=o.getOption(e),s=o.getAdjacentOption(s,1).attr("data-value"),o.refreshOptions("single"!==r),s&&o.setActiveOption(o.getOption(s)),!n.length||null!==o.settings.maxItems&&o.items.length>=o.settings.maxItems?o.close():o.positionDropdown(),o.isFocused&&window.setTimeout(function(){"single"===r?(o.blur(),o.focus(!1),o.hideInput()):o.focus(!1)},0),o.updatePlaceholder(),o.trigger("item_add",e,i),o.updateOriginalInput()))})},removeItem:function(t){var e,i;t=String((e="object"==typeof t?t:this.getItem(t)).attr("data-value")),-1!==(i=this.items.indexOf(t))&&(e.remove(),e.hasClass("active")&&(e=this.$activeItems.indexOf(e[0]),this.$activeItems.splice(e,1)),this.items.splice(i,1),this.lastQuery=null,!this.settings.persist&&this.userOptions.hasOwnProperty(t)&&this.removeOption(t),i<this.caretPos&&this.setCaret(this.caretPos-1),this.refreshClasses(),this.updatePlaceholder(),this.updateOriginalInput(),this.positionDropdown(),this.trigger("item_remove",t))},createItem:function(){var e=this,i=t.trim(e.$control_input.val()||""),s=e.caretPos;if(i.length){e.lock();var n="function"==typeof e.settings.create?this.settings.create:function(t){var i={};return i[e.settings.labelField]=t,i[e.settings.valueField]=t,i},o=c(function(t){e.unlock(),e.focus(!1);var i=t&&t[e.settings.valueField];i&&(e.setTextboxValue(""),e.addOption(i,t),e.setCaret(s),e.addItem(i),e.refreshOptions("single"!==e.settings.mode),e.focus(!1))}),i=n.apply(this,[i,o]);void 0!==i&&o(i)}},refreshItems:function(){if(this.lastQuery=null,this.isSetup)for(var t=0;t<this.items.length;t++)this.addItem(this.items);this.refreshClasses(),this.updateOriginalInput()},refreshClasses:function(){var t=this.isFull(),e=this.isLocked;this.$control.toggleClass("focus",this.isFocused).toggleClass("disabled",this.isDisabled).toggleClass("locked",e).toggleClass("full",t).toggleClass("not-full",!t).toggleClass("dropdown-active",this.isOpen).toggleClass("has-items",0<this.items.length),this.$control_input.data("grow",!t&&!e)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(){var t,e,i;if("select"===this.$input[0].tagName.toLowerCase()){for(i=[],t=0,e=this.items.length;t<e;t++)i.push('<option value="'+h(this.items[t])+'" selected="selected"></option>');i.length||this.$input.attr("multiple")||i.push('<option value="" selected="selected"></option>'),this.$input.html(i.join(""))}else this.$input.val(this.getValue());this.$input.trigger("change"),this.isSetup&&this.trigger("change",this.$input.val())},updatePlaceholder:function(){if(this.settings.placeholder){var t=this.$control_input;this.items.length?t.removeAttr("placeholder"):t.attr("placeholder",this.settings.placeholder),t.triggerHandler("update")}},open:function(){this.isLocked||this.isOpen||"multi"===this.settings.mode&&this.isFull()||(this.focus(!0),this.isOpen=!0,this.refreshClasses(),this.$dropdown.css({visibility:"hidden",display:"block"}),this.positionDropdown(),this.$dropdown.css({visibility:"visible"}),this.trigger("dropdown_open",this.$dropdown))},close:function(){this.isOpen&&(this.$dropdown.hide(),this.setActiveOption(null),this.isOpen=!1,this.refreshClasses(),this.trigger("dropdown_close",this.$dropdown))},positionDropdown:function(){var t=this.$control,e="body"===this.settings.dropdownParent?t.offset():t.position();e.top+=t.outerHeight(!0),this.$dropdown.css({width:t.outerWidth(),top:e.top,left:e.left})},clear:function(){this.items.length&&(this.$control.children(":not(input)").remove(),this.items=[],this.setCaret(0),this.updatePlaceholder(),this.updateOriginalInput(),this.refreshClasses(),this.showInput(),this.trigger("clear"))},insertAtCaret:function(e){var i=Math.min(this.caretPos,this.items.length);0===i?this.$control.prepend(e):t(this.$control[0].childNodes[i]).before(e),this.setCaret(i+1)},deleteSelection:function(e){var i,s,n,o,r;if(i=e&&8===e.keyCode?-1:1,s=v(this.$control_input[0]),this.$activeOption&&!this.settings.hideSelected&&(r=this.getAdjacentOption(this.$activeOption,-1).attr("data-value")),n=[],this.$activeItems.length){for(o=this.$control.children(".active:"+(0<i?"last":"first")),o=this.$control.children(":not(input)").index(o),0<i&&o++,i=0,s=this.$activeItems.length;i<s;i++)n.push(t(this.$activeItems[i]).attr("data-value"));e&&(e.preventDefault(),e.stopPropagation())}else(this.isFocused||"single"===this.settings.mode)&&this.items.length&&(0>i&&0===s.start&&0===s.length?n.push(this.items[this.caretPos-1]):0<i&&s.start===this.$control_input.val().length&&n.push(this.items[this.caretPos]));if(!n.length||"function"==typeof this.settings.onDelete&&!1===this.settings.onDelete(n))return!1;for(void 0!==o&&this.setCaret(o);n.length;)this.removeItem(n.pop());return this.showInput(),this.refreshOptions(!0),r&&(e=this.getOption(r)).length&&this.setActiveOption(e),!0},advanceSelection:function(t,e){var i,s;0!==t&&(i=0<t?"last":"first",s=v(this.$control_input[0]),this.isInputFocused&&!this.isInputHidden?(i=this.$control_input.val().length,(s=0>t?0===s.start&&0===s.length:s.start===i)&&!i&&this.advanceCaret(t,e)):(s=this.$control.children(".active:"+i)).length&&(s=this.$control.children(":not(input)").index(s),this.setActiveItem(null),this.setCaret(0<t?s+1:s),this.showInput()))},advanceCaret:function(t,e){if(0!==t){var i=0<t?"next":"prev";this.isShiftDown?(i=this.$control_input[i]()).length&&(this.hideInput(),this.setActiveItem(i),e&&e.preventDefault()):this.setCaret(this.caretPos+t)}},setCaret:function(e){var i,s,n,o;for(e="single"===this.settings.mode?this.items.length:Math.max(0,Math.min(this.items.length,e)),n=this.$control.children(":not(input)"),i=0,s=n.length;i<s;i++)o=t(n[i]).detach(),i<e?this.$control_input.before(o):this.$control.append(o);this.caretPos=e},lock:function(){this.close(),this.isLocked=!0,this.refreshClasses()},unlock:function(){this.isLocked=!1,this.refreshClasses()},disable:function(){this.isDisabled=!0,this.lock()},enable:function(){this.isDisabled=!1,this.unlock()},render:function(t,e){var i,s,n="",o=!1,r=/^[\\t ]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;if(("option"===t||"item"===t)&&(o=l(i=e[this.settings.valueField])),o&&(l(this.renderCache[t])||(this.renderCache[t]={}),this.renderCache[t].hasOwnProperty(i)))return this.renderCache[t][i];if(this.settings.render&&"function"==typeof this.settings.render[t])n=this.settings.render[t].apply(this,[e,h]);else switch(s=e[this.settings.labelField],t){case"optgroup":n='<div class="optgroup">'+e.html+"</div>";break;case"optgroup_header":n='<div class="optgroup-header">'+h(s=e[this.settings.optgroupLabelField])+"</div>";break;case"option":n='<div class="option">'+h(s)+"</div>";break;case"item":n='<div class="item">'+h(s)+"</div>";break;case"option_create":n='<div class="create">Add <strong>'+h(e.input)+"</strong>&hellip;</div>"}return("option"===t||"option_create"===t)&&(n=n.replace(r,"<$1 data-selectable")),"optgroup"===t&&(s=e[this.settings.optgroupValueField]||"",n=n.replace(r,'<$1 data-group="'+h(s)+'"')),("option"===t||"item"===t)&&(n=n.replace(r,'<$1 data-value="'+h(i||"")+'"')),o&&(this.renderCache[t][i]=n),n}}),m.defaults={plugins:[],delimiter:",",persist:!0,diacritics:!0,create:!1,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,preload:!1,scrollDuration:60,loadThrottle:300,dataAttr:"data-data",optgroupField:"optgroup",sortField:null,sortDirection:"asc",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",optgroupOrder:null,searchField:["text"],mode:null,theme:"default",wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,render:{}},t.fn.selectize=function(e){e=e||{};var i=t.fn.selectize.defaults,s=e.dataAttr||i.dataAttr,n=function(e,i){i.maxItems=e.attr("multiple")?null:1;var n,o,r,a,l=function(t){return"string"==typeof(t=s&&t.attr(s))&&t.length?JSON.parse(t):null},h=function(e,s){var n=(e=t(e)).attr("value")||"";n.length&&(i.options[n]=l(e)||{text:e.html(),value:n,optgroup:s},e.is(":selected")&&i.items.push(n))};for(a=e.children(),n=0,o=a.length;n<o;n++)"optgroup"===(r=a[n].tagName.toLowerCase())?function(e){var s,n=t("option",e),o=(e=t(e)).attr("label");for(o&&o.length&&(i.optgroups[o]=l(e)||{label:o}),e=0,s=n.length;e<s;e++)h(n[e],o)}(a[n]):"option"===r&&h(a[n])};return this.each(function(){var s,o=t(this),r=o[0].tagName.toLowerCase();if(s={placeholder:o.attr("placeholder"),options:{},optgroups:{},items:[]},"select"===r)n(o,s);else{var a,l,r=t.trim(o.val()||"");if(r.length){for(l=r.split(e.delimiter||i.delimiter),r=0,a=l.length;r<a;r++)s.options[l[r]]={text:l[r],value:l[r]};s.items=l}}s=new m(o,t.extend(!0,{},i,s,e)),o.data("selectize",s),o.addClass("selectized")})},t.fn.selectize.defaults=m.defaults,m.registerPlugin("drag_drop",function(e){if(!t.fn.sortable)throw Error('The "drag_drop" Selectize plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var i,s=this;this.setup=(i=s.setup,function(){i.apply(this,arguments);var e=this.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,start:function(t,i){i.placeholder.css("width",i.helper.css("width")),e.css({overflow:"visible"})},stop:function(){e.css({overflow:"hidden"});var i=this.$activeItems?this.$activeItems.slice():null,n=[];e.children("[data-value]").each(function(){n.push(t(this).attr("data-value"))}),s.setValue(n),s.setActiveItem(i)}})})}}),m.registerPlugin("dropdown_header",function(e){var i,s=this;e=t.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(t){return'<div class="'+t.headerClass+'"><div class="'+t.titleRowClass+'"><span class="'+t.labelClass+'">'+t.title+'</span><a href="javascript:void(0)" class="'+t.closeClass+'">&times;</a></div></div>'}},e),s.setup=(i=s.setup,function(){i.apply(s,arguments),s.$dropdown_header=t(e.html(e)),s.$dropdown.prepend(s.$dropdown_header)})}),m.registerPlugin("optgroup_columns",function(e){var i,s=this;e=t.extend({equalizeWidth:!0,equalizeHeight:!0},e),this.getAdjacentOption=function(e,i){var s=e.closest("[data-group]").find("[data-selectable]"),n=s.index(e)+i;return 0<=n&&n<s.length?s.eq(n):t()},this.onKeyDown=(i=s.onKeyDown,function(t){var e,n;if(!this.isOpen||37!==t.keyCode&&39!==t.keyCode)return i.apply(this,arguments);s.ignoreHover=!0,e=(n=this.$activeOption.closest("[data-group]")).find("[data-selectable]").index(this.$activeOption),(e=(n=(n=37===t.keyCode?n.prev("[data-group]"):n.next("[data-group]")).find("[data-selectable]")).eq(Math.min(n.length-1,e))).length&&this.setActiveOption(e)});var n=function(){var i,n,o,r;if((n=(r=t("[data-group]",s.$dropdown_content)).length)&&s.$dropdown_content.width()){if(e.equalizeHeight){for(i=o=0;i<n;i++)o=Math.max(o,r.eq(i).height());r.css({height:o})}e.equalizeWidth&&(i=Math.round((o=s.$dropdown_content.innerWidth())/n),r.css({width:i}),1<n&&(i=o-i*(n-1),r.eq(n-1).css({width:i})))}};(e.equalizeHeight||e.equalizeWidth)&&(u.after(this,"positionDropdown",n),u.after(this,"refreshOptions",n))}),m.registerPlugin("remove_button",function(e){var i,s=this;this.settings.render.item=function(t){return'<div class="item">'+t[s.settings.labelField]+' <a href="javascript:void(0)" class="remove" tabindex="-1" title="Remove">&times;</a></div>'},this.setup=(i=s.setup,function(){i.apply(this,arguments),this.$control.on("click",".remove",function(e){e.preventDefault(),e=t(e.target).parent(),s.setActiveItem(e),s.deleteSelection()&&s.setCaret(s.items.length)})})}),m.registerPlugin("restore_on_backspace",function(t){var e;t.text=t.text||function(t){return t[this.settings.labelField]},this.onKeyDown=(e=this.onKeyDown,function(i){var s;if(8===i.keyCode&&""===this.$control_input.val()&&!this.$activeItems.length&&0<=(s=this.caretPos-1)&&s<this.items.length){s=this.options[this.items[s]],this.deleteSelection(i)&&(this.setTextboxValue(t.text.apply(this,[s])),this.refreshOptions(!0)),i.preventDefault();return}return e.apply(this,arguments)})}),m});